 <h1>Select the data that matters to you:<br></h1>
  <p></p>

  <!-- create the checkboxes-->
  <strong>Data Fields</strong><br>
  Coldest Daily Temperature: <input type="checkbox" id="low_temp"><br>
  Hottest Daily Temperature: <input type="checkbox" id="high_temp"><br>
  Precipitous Days: <input type="checkbox" id="precip_num_days"><br>
  Population Density: <input type="checkbox" id="density_group"><br>
  Median Individual Income: <input type="checkbox" id="income_individual_median"><br>
  Home Value: <input type="checkbox" id="home_value"><br>
  Median Rent: <input type="checkbox" id="rent_median"><br>
  Median Age: <input type="checkbox" id="age_median_group"><br>
  Unemployment Rate: <input type="checkbox" id="unemployment_rate_average"><br>
  Crime Rate per 100,000: <input type="checkbox" id="crime_rate_per_100000"><br>

  <!-- Selection for reference county-->
 <strong>Reference County</strong><br>
 State <select name="stateSelect" id="stateSelect" onchange="if (this.selectedIndex) changeCounties(this.options[this.selectedIndex].text);">
     <option value="--">--</option>
 </select><br>
 County <select name="countySelect" id="countySelect">
     <option value="--">--</option>
 </select><br>

  <!-- Button to reset view-->
  <button onclick="generateView()">Generate View</button>

   <script>
    function generateView() {
      // insert call to appropriate page here
      const page = window.location.href.split("spec")[0]

      //following code checks all checkboxes for state
      //creates array with id names of all checked boxes
      var array = []
      var checkboxes = document.querySelectorAll('input[type=checkbox]:checked')

      for (var i = 0; i < checkboxes.length; i++) {
        array.push(checkboxes[i].id)
      }

      const county_selector = document.querySelector('select[id="countySelect"]')
      const county = county_selector.options[county_selector.selectedIndex]

      const state_selector = document.querySelector('select[id="stateSelect"]')
      const state = state_selector.options[state_selector.selectedIndex]

      var newPage = page + "spec/" + array.join(";")
      if ((county.text !== "--") && (state.text !== "--"))  { newPage = newPage + "?reference_county=" + county.text + "&" + "reference_state=" + state.text}
      console.log(newPage)
      window.location.href = newPage
    }

    function changeCounties(state) {
      jQuery.getJSON("{{ url_for('static', filename='data_sources/county_by_state_list.json') }}", function(json) {
        var selector = document.querySelector('select[id="countySelect"]')

        jQuery("#countySelect").empty();

        var opt = document.createElement('option');
        opt.value = '--';
        opt.innerHTML = '--';
        selector.appendChild(opt);

        console.log(json[state])
        json[state].forEach(c => {
            var opt = document.createElement('option');
            opt.value = c;
            opt.innerHTML = c;
            selector.appendChild(opt);
        })
      });
    }

    function persistReferenceCounty() {
      if (window.location.search) {
        var search = window.location.search.substring(1);
        var queryParams = JSON.parse('{"' + decodeURI(search).replace(/"/g, '\\"').replace(/&/g, '","').replace(/=/g,'":"') + '"}');
        console.log(queryParams);
        document.getElementById("stateSelect").value = queryParams["reference_state"];
        changeCounties(queryParams["reference_state"]);
        document.getElementById("countySelect").value = queryParams["reference_county"];
      }
    }
  </script>

  <script type="text/javascript" defer>
  // script will parse the URL, extract the everything after the final '/'
  // then separate any parameters with ';'
  const paramArr = window.location.href.split("/").slice(-1)[0].split("?")[0].split(";")

  //iterate through paramArr
  //set checked=true for respective parameters (checkboxes with corresponding variables)
  const checks = document.querySelectorAll('input[type=checkbox]')
  if (paramArr !== null) { checks.forEach(check => check.checked=(paramArr.includes(check.id))) };

  //populate the state dropdown
  jQuery.getJSON("{{ url_for('static', filename='data_sources/county_by_state_list.json') }}", function(json) {
    var selector = document.querySelector('select[id="stateSelect"]')

    for (let s in json) {
        var opt = document.createElement('option');
        opt.value = s;
        opt.innerHTML = s;
        selector.appendChild(opt);
    }
  });

  var search = window.location.search.substring(1);
  var queryParams = JSON.parse('{"' + decodeURI(search).replace(/"/g, '\\"').replace(/&/g, '","').replace(/=/g,'":"') + '"}');
  console.log(queryParams);
  document.getElementById("stateSelect").val = queryParams["reference_state"];
  persistReferenceCounty();

<!--  console.log(JSON.parse('{{ Kwargs | tojson | safe}}'))-->
<!--  console.log(JSON.parse('{{ vars_list | tojson | safe}}'))-->
  </script>
